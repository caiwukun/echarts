<!DOCTYPE html>
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->


<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="lib/simpleRequire.js"></script>
        <script src="lib/config.js"></script>
        <script src="lib/jquery.min.js"></script>
        <script src="lib/facePrint.js"></script>
        <script src="lib/testHelper.js"></script>
        <!-- <script src="ut/lib/canteen.js"></script> -->
        <link rel="stylesheet" href="lib/reset.css" />
    </head>
    <body>
        <style>
        </style>



        <div id="main0"></div>
        <div id="main1"></div>
        <div id="main2"></div>






        <script>
        require([
            'echarts',
            // 'map/js/china',
            // './data/nutrients.json'
        ], function (echarts) {
            var option;

            option = {
                xAxis: {
                    data: ['Animals', 'Fruits', 'Cars']
                },
                yAxis: {},
                dataGroupId: '',
                // animationDurationUpdate: 1000,
                series: {
                    type: 'bar',
                    id: 'main',
                    data: [{
                        value: 5,
                        groupId: 'animals'
                    }, {
                        value: 2,
                        groupId: 'fruits'
                    }, {
                        value: 4,
                        groupId: 'cars'
                    }],
                    universalTransition: {
                        enabled: true
                    }
                }
            };

            const drilldownData = [{
                dataGroupId: 'animals',
                data: [
                    ['Cats', 4],
                    ['Dogs', 2],
                    ['Cows', 1],
                    ['Sheep', 2],
                    ['Pigs', 1]
                ]
            }, {
                dataGroupId: 'fruits',
                data: [
                    ['Apples', 4],
                    ['Oranges', 2]
                ]
            }, {
                dataGroupId: 'cars',
                data: [
                    ['Toyota', 4],
                    ['Opel', 2],
                    ['Volkswagen', 2]
                ]
            }];

            var chart = testHelper.create(echarts, 'main0', {
                title: [
                    'Drilldown of bar chart.'
                ],
                option: option
                // height: 300,
                // buttons: [{text: 'btn-txt', onclick: function () {}}],
            });

            chart.on('click', function (event) {
                if (event.data) {
                    const subData = drilldownData.find(data => {
                        return data.dataGroupId === event.data.groupId;
                    });
                    if (!subData) {
                        return;
                    }
                    chart.setOption({
                        xAxis: {
                            data: subData.data.map(item => item[0])
                        },
                        yAxis: {},
                        series: {
                            type: 'bar',
                            id: 'main',
                            // animationDurationUpdate: 1000,
                            dataGroupId: subData.dataGroupId,
                            data: subData.data.map(item => item[1]),
                            universalTransition: {
                                enabled: true
                            }
                        },
                        graphic: [{
                            type: 'text',
                            left: 50,
                            top: 20,
                            style: {
                                text: 'Back',
                                fontSize: 18
                            },
                            onclick() {
                                chart.setOption(option);
                            }
                        }]
                    });
                }
            });
        });
        </script>

        <script>

            require([
                'echarts', 'ecStat', 'ecSimpleTransform'
            ], function (echarts, ecStat, ecSimpleTransform) {

                echarts.registerTransform(ecSimpleTransform.aggregate);
                echarts.registerTransform(ecStat.transform.clustering);
                echarts.registerTransform(ecSimpleTransform.id);

                const RAW_DATA = [[1425139200000,34,0.13,2,"MD","ZD","P0"],[1425225600000,28,0.71,1.5,"MB","ZD","P1"],[1425312000000,23,0.9,2.8,"MA","ZC","P2"],[1425398400000,21,0.58,6,"MB","ZC","P3"],[1425484800000,14,0.1,1.6,"MC","ZA","P4"],[1425571200000,21,0.6,7.7,"MC","ZA","P5"],[1425657600000,23,0.31,2.6,"MC","ZC","P6"],[1425744000000,34,0.74,2.4,"MD","ZE","P7"],[1425830400000,14,0.59,2.3,"MB","ZD","P8"],[1425916800000,18,0.85,5.1,"MB","ZB","P9"],[1426003200000,36,0.96,1.2,"MC","ZC","P10"],[1426089600000,18,0.28,2.5,"MA","ZC","P11"],[1426176000000,20,0.62,6,"MB","ZD","P12"],[1426262400000,32,0.79,1.7,"MB","ZA","P13"],[1426348800000,17,0.58,4.4,"MD","ZB","P14"],[1426435200000,23,0.77,3,"MB","ZA","P15"],[1426521600000,39,0.87,4.6,"MC","ZA","P16"],[1426608000000,15,0.7,6,"MB","ZC","P17"],[1426694400000,21,0.94,2.7,"MB","ZD","P18"],[1426780800000,28,0.48,4.5,"MC","ZC","P19"],[1426867200000,31,0.49,9.8,"MA","ZC","P20"],[1426953600000,27,0.87,7.7,"MB","ZB","P21"],[1427040000000,27,0.82,5.5,"MC","ZB","P22"],[1427126400000,11,0.53,2.7,"MD","ZC","P23"],[1427212800000,13,0.7,7.6,"MB","ZD","P24"],[1427299200000,39,0.99,4.8,"MB","ZD","P25"],[1427385600000,32,0.91,2.1,"MB","ZE","P26"],[1427472000000,20,0.97,5,"MB","ZA","P27"],[1427558400000,36,0.01,8.9,"MB","ZD","P28"],[1427644800000,22,0.08,9.2,"MB","ZE","P29"],[1427731200000,21,0.36,3.1,"MD","ZC","P30"],[1427817600000,11,0.15,5.8,"MD","ZB","P31"],[1427904000000,39,0.02,1.4,"MC","ZD","P32"],[1427990400000,20,0.86,8.7,"MB","ZD","P33"],[1428076800000,23,0.24,7.2,"MD","ZB","P34"],[1428163200000,12,0.06,2,"MD","ZB","P35"],[1428249600000,36,0.42,8.2,"MA","ZB","P36"],[1428336000000,17,0.48,7.5,"MB","ZC","P37"],[1428422400000,19,0.12,6.6,"MB","ZB","P38"],[1428508800000,39,0.58,3.1,"MC","ZE","P39"],[1428595200000,10,0.18,6.6,"MC","ZD","P40"],[1428681600000,22,0.28,2.1,"MB","ZE","P41"],[1428768000000,27,0.33,1.9,"MC","ZB","P42"],[1428854400000,37,0.46,9.4,"MD","ZE","P43"],[1428940800000,18,0.96,5.5,"MB","ZA","P44"],[1429027200000,11,0.61,8.2,"MD","ZC","P45"],[1429113600000,15,0.88,4.6,"MD","ZA","P46"],[1429200000000,38,0.89,7.2,"MD","ZC","P47"],[1429286400000,20,0.39,5.4,"MB","ZB","P48"],[1429372800000,30,0.71,5.5,"MA","ZA","P49"]];
                const RAW_DATA_DIMENSIONS = ['DATE', 'COUNT', 'PRICE', 'WEIGHT', 'M_TAG', 'Z_TAG', 'ID'];


                const datasetOption = [{
                    id: 'raw_dataset',
                    dimensions: RAW_DATA_DIMENSIONS,
                    source: RAW_DATA
                }, {
                    id: 'raw_clustered_dataset',
                    fromDatasetId: 'raw_dataset',
                    transform: {
                        type: 'ecStat:clustering',
                        config: {
                            clusterCount: 4,
                            dimensions: ['COUNT', 'PRICE'],
                            outputClusterIndexDimension: {
                                index: RAW_DATA_DIMENSIONS.length,
                                name: 'CLUSTER_IDX'
                            },
                            outputCentroidDimensions: [{
                                index: RAW_DATA_DIMENSIONS.length + 1,
                                name: 'CLUSTER_CENTER_COUNT'
                            }, {
                                index: RAW_DATA_DIMENSIONS.length + 2,
                                name: 'CLUSTER_CENTER_PRICE'
                            }]
                        }
                    }
                }, {
                    id: 'raw_cluster_centers_dataset',
                    fromDatasetId: 'raw_clustered_dataset',
                    transform: {
                        type: 'ecSimpleTransform:aggregate',
                        config: {
                            resultDimensions: [
                                { from: 'COUNT', method: 'count' },
                                { from: 'CLUSTER_CENTER_COUNT', method: 'first' },
                                { from: 'CLUSTER_CENTER_PRICE', method: 'first' },
                                { from: 'CLUSTER_IDX' }
                            ],
                            groupBy: 'CLUSTER_IDX'
                        }
                    }
                }];

                const rawScatterOption = {
                    dataset: datasetOption,
                    xAxis: {
                        name: 'PRICE'
                    },
                    yAxis: {
                        name: 'COUNT'
                    },
                    series: {
                        type: 'scatter',
                        id: 'main',
                        animationDurationUpdate: 1000,
                        datasetId: 'raw_clustered_dataset',
                        symbolSize: 20,
                        encode: {
                            itemName: 'ID',
                            x: 'PRICE',
                            y: 'COUNT',
                            itemGroupId: 'CLUSTER_IDX',
                            tooltip: ['PRICE', 'COUNT', 'WEIGHT']
                        },
                        universalTransition: {
                            enabled: true
                        }
                    }
                };

                const clusteredScatterOption = {
                    dataset: datasetOption,
                    xAxis: {
                        name: 'PRICE'
                    },
                    yAxis: {
                        name: 'COUNT'
                    },
                    series: {
                        type: 'scatter',
                        id: 'main',
                        animationDurationUpdate: 1000,
                        datasetId: 'raw_cluster_centers_dataset',
                        symbolSize: 50,
                        encode: {
                            x: 'CLUSTER_CENTER_PRICE',
                            y: 'CLUSTER_CENTER_COUNT',
                            itemGroupId: 'CLUSTER_IDX',
                            tooltip: ['CLUSTER_CENTER_PRICE', 'CLUSTER_CENTER_COUNT']
                        },
                        universalTransition: {
                            enabled: true,
                            divideShape: 'clone'
                        }
                    }
                }

                var chart = testHelper.create(echarts, 'main1', {
                    title: [
                        'Transition of cluster',
                        `Use divideShape: 'clone'`
                    ],
                    option: rawScatterOption,
                    // height: 300,
                    buttons: [{
                        text: 'All',
                        onclick: function () {
                            chart.setOption(rawScatterOption);
                        }
                    }, {
                        text: 'Clustered',
                        onclick: function () {
                            chart.setOption(clusteredScatterOption);
                        }
                    }],
                });
            });
        </script>

        <script>
            require([
                'echarts', 'ecStat', 'ecSimpleTransform',
                'data/life-expectancy-table.json'
            ], function (echarts, ecStat, ecSimpleTransform, rawData) {

                echarts.registerTransform(ecSimpleTransform.aggregate);
                echarts.registerTransform(ecSimpleTransform.id);

                const RAW_DATA_DIMENSIONS = ['Income', 'Life Expectancy', 'Population', 'Country', 'Year'];
                const SUM_INCOME_DIMENSIONS = ['Income', 'Country'];
                const COUNTRY_A = 'Germany';
                const COUNTRY_B = 'France';

                const datasetOption = [
                    {
                        id: 'RawData',
                        source: rawData
                    },
                    {
                        id: 'CountryAData',
                        fromDatasetId: 'RawData',
                        transform: {
                            type: 'filter',
                            config: {
                                dimension: 'Country', '=': COUNTRY_A
                            }
                        }
                    },
                    {
                        id: 'CountryBData',
                        fromDatasetId: 'RawData',
                        transform: {
                            type: 'filter',
                            config: {
                                dimension: 'Country', '=': COUNTRY_B
                            }
                        }
                    },
                    {
                        id: 'CountryABData',
                        fromDatasetId: 'RawData',
                        transform: {
                            type: 'filter',
                            config: {
                                or: [{
                                    dimension: 'Country', '=': COUNTRY_B
                                }, {
                                    dimension: 'Country', '=': COUNTRY_A
                                }]
                            }
                        }
                    },
                    {
                        id: `GroupByCountry`,
                        fromDatasetId: 'CountryABData',
                        transform: {
                            type: 'ecSimpleTransform:aggregate',
                            config: {
                                resultDimensions: [
                                    { from: 'Income', method: 'sum' },
                                    { from: 'Country' }
                                ],
                                groupBy: 'Country'
                            }
                        }
                    }
                ];

                function createOption(xDim, yDim, seriesType, groupBy, stack) {
                    const isGridSeries = seriesType !== 'pie';
                    return {
                        animationDurationUpdate: 1000,
                        dataset: datasetOption,

                        legend: {},

                        tooltip: {
                            position: 'top'
                        },

                        xAxis: isGridSeries ? {
                            name: xDim,
                            type: 'category'
                        } : null,
                        yAxis: isGridSeries ? {
                            name: yDim
                        } : null,
                        series: groupBy ?
                            [{
                                type: seriesType,
                                name: 'Both Country',
                                id: 'CountryAB',
                                datasetId: 'GroupByCountry',
                                universalTransition: {
                                    seriesKey: ['CountryA', 'CountryB'],
                                    enabled: true
                                },
                                encode: {
                                    ...(isGridSeries ? {
                                        x: xDim,
                                        y: yDim
                                    } : {
                                        itemName: yDim,
                                        value: xDim
                                    }),
                                    itemGroupId: groupBy
                                }
                            }]
                            : [{
                                type: seriesType,
                                name: COUNTRY_A,
                                id: 'CountryA',
                                datasetId: 'CountryAData',
                                stack,
                                symbol: 'circle',
                                universalTransition: {
                                    enabled: true
                                },
                                encode: {
                                    x: xDim,
                                    y: yDim,
                                    itemGroupId: groupBy
                                }
                            }, {
                                type: seriesType,
                                name: COUNTRY_B,
                                id: 'CountryB',
                                datasetId: 'CountryBData',
                                stack,
                                symbol: 'circle',
                                universalTransition: {
                                    enabled: true
                                },
                                encode: {
                                    x: xDim,
                                    y: yDim,
                                    itemGroupId: groupBy
                                }
                            }]
                    }
                }

                let currentOptionIdx = 0;

                const options = [
                    {
                        option: createOption('Year', 'Income', 'bar')
                    },
                    {
                        option: createOption('Year', 'Population', 'scatter')
                    },
                    {
                        option: createOption('Year', 'Population', 'line')
                    },
                    {
                        option: createOption('Year', 'Population', 'bar')
                    },
                    {
                        option: createOption('Year', 'Population', 'bar', '', 'stack')
                    },
                    {
                        option: createOption('Income', 'Country', 'pie', 'Country')
                    },
                    {
                        option: createOption('Country', 'Income', 'bar', 'Country')
                    }
                ];

                console.log(options);

                function createNextOption() {
                    currentOptionIdx = (currentOptionIdx + 1) % options.length;
                    const option = options[currentOptionIdx].option;
                    return option;
                }

                function createPrevOption() {
                    currentOptionIdx = currentOptionIdx - 1;
                    if (currentOptionIdx < 0) {
                        currentOptionIdx = options.length - 1;
                    }
                    const option = options[currentOptionIdx].option;
                    return option;
                }

                var chart = testHelper.create(echarts, 'main2', {
                    title: [
                        'Transition with dataset transform.'
                    ],
                    option: options[currentOptionIdx].option,
                    // height: 300,
                    buttons: [{
                        text: 'prev',
                        onclick: function () {
                            chart.setOption(createPrevOption(), true);
                        }
                    }, {
                        text: 'next',
                        onclick: function () {
                            chart.setOption(createNextOption(), true);
                        }
                    }],
                });
            });
        </script>
    </body>
</html>

