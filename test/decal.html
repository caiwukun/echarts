<!DOCTYPE html>
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->


<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="lib/esl.js"></script>
        <script src="lib/config.js"></script>
        <script src="lib/jquery.min.js"></script>
        <script src="lib/facePrint.js"></script>
        <script src="lib/testHelper.js"></script>
        <!-- <script src="ut/lib/canteen.js"></script> -->
        <link rel="stylesheet" href="lib/reset.css" />
    </head>
    <body>
        <style>
            table {
                padding: 20px;
            }
            tr {
                padding: 5px;
            }
        </style>



        <div id="main0"></div>
        <div id="main1"></div>
        <div id="main2"></div>

        <table>
            <tr>
                <td>
                    <button onclick="randAll()">Random All</button>
                </td>
            </tr>
            <tr>
                <td>
                    symbolSize
                </td>
                <td>
                    <input type="range" min="0" max="1" value="1" step="0.01" id="symbolSize-range">
                    <label id="symbolSize-label">1</label>
                </td>
                <td>
                    <button onclick="rand('symbolSize', 0, 1)">Random</button>
                </td>
            </tr>
            <tr>
                <td>
                    dashArrayX
                </td>
                <td>
                    <input type="range" min="0" max="50" value="10" id="dashArrayX-0-range">
                    <input type="range" min="0" max="50" value="10" id="dashArrayX-1-range">
                    <label id="dashArrayX-label">[10, 10]</label>
                </td>
                <td>
                    <button onclick="rand('dashArrayX-0', 0, 100)">Random</button>
                </td>
            </tr>
            <tr>
                <td>
                    dashArrayY
                </td>
                <td>
                    <input type="range" min="0" max="50" value="10" id="dashArrayY-0-range">
                    <input type="range" min="0" max="50" value="10" id="dashArrayY-1-range">
                    <label id="dashArrayY-label">[10, 10]</label>
                </td>
                <td>
                    <button onclick="rand('dashArrayY-0', 0, 100)">Random</button>
                </td>
            </tr>
            <tr>
                <td>
                    rotation
                </td>
                <td>
                    <input type="range" min="0" max="3.14" value="0" step="0.01" id="rotation-range">
                    <label id="rotation-label">0</label>
                </td>
                <td>
                    <button onclick="rand('rotation', 0, 3.14)">Random</button>
                </td>
            </tr>
        </table>


        <div id="main-sankey"></div>
        <div id="main-sunburst"></div>
        <div id="main-treemap"></div>
        <div id="main-custom-series"></div>



        <script>
        require(['echarts'/*, 'map/js/china' */], function (echarts) {
            var option;
            var series = [];
            var pieData = [];
            var legendNames = [];
            var itemStyle = {
                decal: {
                    color: 'blue'
                }
            };
            for (var i = 0; i < 12; ++i) {
                var s = {
                    name: 'bar' + i,
                    data: [i * 10 + 100],
                    type: 'bar'
                };
                if (i === 0) {
                    s.itemStyle = itemStyle;
                }
                else if (i === 1) {
                    s.itemStyle = {
                        decal: 'none'
                    };
                }
                else if (i === 2) {
                    s.data = [{
                        value: s.data[0],
                        itemStyle: {
                            decal: 'none'
                        }
                    }];
                }
                series.push(s);

                var p = {
                    name: 'pie' + i,
                    value: i * 5 + 10
                };
                pieData.push(p);

                legendNames.push('bar' + i, 'pie' + i);
            }
            series.push({
                type: 'pie',
                center: ['75%', '50%'],
                data: pieData,
                radius: '50%'
            });

            option = {
                legend: {
                    data: legendNames
                },
                xAxis: {
                    type: 'category',
                    data: ['x']
                },
                yAxis: {
                    type: 'value'
                },
                series: series,
                grid: {
                    left: 50,
                    right: '40%'
                },
                aria: {
                    decal: {
                        show: true
                    }
                }
            };

            var chart = testHelper.create(echarts, 'main0', {
                title: [
                    'It should use decal when aria.show is true',
                    '(1) Each bar and pie piece should have different decal',
                    '(2) The first bar and pie piece decal should be **blue**',
                    '(3) The second and third bar should not have decal'
                ],
                option: option
                // height: 300,
                // buttons: [{text: 'btn-txt', onclick: function () {}}],
                // recordCanvas: true,
            });
        });
        </script>



        <script>
        require(['echarts'/*, 'map/js/china' */], function (echarts) {
            var option;
            var series = [];
            var pieData = [];
            var itemStyle = {
                decal: {
                    color: 'blue',
                    symbol: [['rect', 'circle', 'triangle'], ['circle', 'none']]
                }
            };
            for (var i = 0; i < 6; ++i) {
                var s = {
                    name: 'bar' + i,
                    data: [i * 10 + 100],
                    type: 'bar'
                };
                if (i === 0) {
                    s.itemStyle = itemStyle;
                    s.emphasis = {
                        itemStyle: {
                            decal: {
                                color: 'red'
                            }
                        }
                    }
                }
                series.push(s);

                var p = {
                    name: 'pie' + i,
                    value: i * 5 + 10
                };
                if (i === 0) {
                    p.itemStyle = itemStyle;
                    p.emphasis = {
                        itemStyle: {
                            decal: {
                                color: 'red'
                            }
                        }
                    }
                }
                pieData.push(p);
            }
            series.push({
                type: 'pie',
                center: ['75%', '50%'],
                data: pieData,
                radius: '50%'
            });

            option = {
                xAxis: {
                    type: 'category',
                    data: ['x']
                },
                yAxis: {
                    type: 'value'
                },
                series: series,
                grid: {
                    left: 50,
                    right: '40%'
                },
                aria: {
                    // no decal
                }
            };

            var chart = testHelper.create(echarts, 'main1', {
                title: [
                    'If aria is not enabled, decal can also be enabled',
                    '(1) Only the first bar and pie piece should use decal (be **blue**)',
                    '(2) `aria.label` should be in the HTML'
                ],
                option: option
            });
        });
        </script>





        <script>
        var option;
        var decal = {
            symbolSize: 1,
            dashArrayX: [10, 10],
            dashArrayY: [10, 10],
            rotation: 0,
            maxTileWidth: 256,
            maxTileHeight: 256
        };

        option = {
            xAxis: {
                type: 'category',
                data: ['a', 'b'],
                show: false
            },
            yAxis: {
                type: 'value',
                show: false
            },
            series: [{
                type: 'bar',
                data: [70, 40],
                itemStyle: {
                    decal: decal,
                    borderWidth: 20,
                    borderColor: '#ff0'
                }
            }, {
                type: 'line',
                data: [100, 80],
                itemStyle: {
                    decal: decal,
                    borderWidth: 20,
                    borderColor: '#ff0'
                },
                lineStyle: {
                    width: 20
                },
                symbol: 'circle',
                symbolSize: 200
            }],
            grid: {
                left: 50,
                right: 20
            },
            aria: {
                show: true
            },
            animation: false
        };
        var chart;
        require(['echarts'/*, 'map/js/china' */], function (echarts) {

            chart = testHelper.create(echarts, 'main2', {
                title: [
                    'Change parameters and check if it goes into endless loop'
                ],
                option: option
            });

            ['symbolSize', 'dashArrayX-0', 'dashArrayX-1', 'dashArrayY-0', 'dashArrayY-1', 'rotation'].forEach(function (name) {
                var input = document.getElementById(name + '-range');
                var nameSplit = name.split('-');
                var attrName = nameSplit[0];
                var idName = nameSplit[1];
                var label = document.getElementById(attrName + '-label');
                input.addEventListener('change', function (event) {
                    var value = event.target.value;
                    var labelText = +value;
                    var rangeValue = +value;
                    if (idName) {
                        var otherId = idName === '0' ? '1' : '0';
                        var otherValue = document.getElementById(attrName + '-' + otherId + '-range').value;
                        labelText = idName === '0'
                            ? '[' + value + ', ' + otherValue + ']'
                            : '[' + otherValue + ', ' + value + ']';
                        rangeValue = idName === '0'
                            ? [+value, +otherValue]
                            : [+otherValue, +value];
                    }
                    label.innerText = labelText;

                    decal[attrName] = rangeValue;
                    chart.setOption(option);
                });
            });
        });

        function rand(name, min, max) {
            var n = Math.random() * (max - min) + min;
            var value = max < 10 ? Math.floor(n * 100) / 100 : Math.floor(n);

            var nameSplit = name.split('-');
            var attrName = nameSplit[0];
            var idName = nameSplit[1];
            var labelText = value;
            var rangeValue = value;
            var label = document.getElementById(attrName + '-label');
            if (idName) {
                var otherN = Math.random() * (max - min) + min;
                var otherValue = max < 10 ? Math.floor(otherN * 100) / 100 : Math.floor(otherN);
                document.getElementById(attrName + '-1-range').value = otherValue;

                labelText = idName === '0'
                    ? '[' + value + ', ' + otherValue + ']'
                    : '[' + otherValue + ', ' + value + ']';
                rangeValue = idName === '0'
                    ? [+value, +otherValue]
                    : [+otherValue, +value];
            }
            label.innerText = labelText;

            var input = document.getElementById(name + '-range');
            input.value = value;

            decal[attrName] = rangeValue;
            chart.setOption(option);
        }

        function randAll() {
            rand('symbolSize', 0, 1);
            rand('dashArrayX-0', 0, 50);
            rand('dashArrayY-0', 0, 50);
            rand('rotation', 0, 3.14);
        }
        </script>










        <script>
        require(['echarts'/*, 'map/js/china' */], function (echarts) {


            var testData =  {
                nodes: [
                    {
                        name: 'a',
                        itemStyle: {
                            decal: {
                                color: 'yellow'
                            }
                        }
                    },
                    {
                        name: 'b',
                        depth: 2
                    },
                    {
                        name: 'a1',
                        depth: 4
                    },
                    {
                        name: 'b1'
                    },
                    {
                        name: 'c',
                        depth: 3
                    },
                    {
                        name: 'e',
                        depth: 1
                    }
                ],
                links: [
                    {
                        source: 'a',
                        target: 'a1',
                        value: 5
                    },
                    {
                        source: 'e',
                        target: 'b',
                        value: 3
                    },
                    {
                        source: 'a',
                        target: 'b1',
                        value: 0
                    },
                    {
                        source: 'b1',
                        target: 'a1',
                        value: 1
                    },
                    {
                        source: 'b1',
                        target: 'c',
                        value: 3
                    },
                    {
                        source: 'b',
                        target: 'c',
                        value: 3
                    }
                ]
            };

            var option = {
                aria: {
                    decal: { show: true }
                },
                tooltip: {
                    trigger: 'item',
                    triggerOn: 'mousemove'
                },
                animation: false,
                series: [
                    {
                        type: 'sankey',
                        bottom: '10%',
                        focusNodeAdjacency: true,
                        itemStyle: {
                            decal: {
                                color: 'blue'
                            }
                        },
                        data: testData.nodes,
                        links: testData.links
                    }
                ]
            };

            var chart = testHelper.create(echarts, 'main-sankey', {
                title: [
                    'All sankey nodes should have decal (they are from palette)',
                    'decal color of all except "a" is **blue** (they are from series.itemStyle)',
                    'decal color of "a" is **yellow** (it is from dataItem.itemStyle)'
                ],
                option: option
            });
        });
        </script>



        <script>
        require(['echarts'/*, 'map/js/china' */], function (echarts) {
            var data = [{
                children: [{
                    value: 5,
                    children: [{
                        value: 1
                    }, {
                        value: 2,
                        children: [{
                            value: 1
                        }]
                    }, {
                        children: [{
                            value: 1
                        }]
                    }]
                }, {
                    value: 10,
                    children: [{
                        value: 6,
                        children: [{
                            value: 1
                        }, {
                            value: 1
                        }, {
                            value: 1
                        }, {
                            value: 1
                        }]
                    }, {
                        value: 2,
                        children: [{
                            value: 1
                        }]
                    }, {
                        children: [{
                            value: 1
                        }]
                    }]
                }]
            }, {
                value: 9,
                children: [{
                    value: 4,
                    children: [{
                        value: 2
                    }, {
                        children: [{
                            value: 1
                        }]
                    }]
                }, {
                    children: [{
                        value: 3,
                        children: [{
                            value: 1
                        }, {
                            value: 1
                        }]
                    }]
                }]
            }, {
                value: 7,
                children: [{
                    children: [{
                        value: 1
                    }, {
                        value: 3,
                        children: [{
                            value: 1
                        }, {
                            value: 1
                        }]
                    }, {
                        value: 2,
                        children: [{
                            value: 1
                        }, {
                            value: 1
                        }]
                    }]
                }]
            }, {
                children: [{
                    value: 6,
                    children: [{
                        value: 1
                    }, {
                        value: 2,
                        children: [{
                            value: 2
                        }]
                    }, {
                        value: 1
                    }]
                }, {
                    value: 3,
                    children: [{
                        value: 1,
                    }, {
                        children: [{
                            value: 1
                        }]
                    }, {
                        value: 1
                    }]
                }]
            }];

            var option = {
                aria: {
                    decal: { show: true }
                },
                series: {
                    type: 'sunburst',
                    data: data
                }
            };

            var chart = testHelper.create(echarts, 'main-sunburst', {
                title: [
                    'All sunburst nodes should have decal (by 1st level) (they are from palette)'
                ],
                option: option
            });
        });
        </script>



        <script>
        require(['echarts'/*, 'map/js/china' */], function (echarts) {
            var option = {
                aria: {
                    decal: { show: true }
                },
                series: [{
                    name: 'tm',
                    type: 'treemap',
                    roam: false,
                    label: {
                        position: 'insideRight',
                        emphasis: {
                            show: true
                        }
                    },
                    leafDepth: 1,
                    levels: [{
                        itemStyle: {
                            borderColor: '#333',
                            borderWidth: 4,
                            gapWidth: 2
                        }
                    }, {
                        itemStyle: {
                            borderColor: '#aaa',
                            gapWidth: 2,
                            borderWidth: 2
                        },
                        colorSaturation: [0.2, 0.7]
                    }],
                    data: [{
                        name: 'a',
                        value: 10,
                        children: [{
                            name: 'a1',
                            value: 11,
                            children: [{
                                name: 'a11',
                                value: 111,
                            }, {
                                name: 'a111',
                                value: 1111
                            }, {
                                name: 'a112',
                                value: 1111
                            }, {
                                name: 'a113',
                                value: 111
                            }, {
                                name: 'a114',
                                value: 111
                            }, {
                                name: 'a115',
                                value: 1100
                            }]
                        }]
                    }, {
                        name: 'b',
                        value: 6,
                        children: [{
                            name: 'b1',
                            value: 15,
                            children: [{
                                name: 'b11',
                                value: 120
                            }]
                        }]
                    }]
                }]
            };

            var chart = testHelper.create(echarts, 'main-treemap', {
                title: [
                    'All treemap nodes should have decal (by 1st level) (they are from palette)'
                ],
                option: option
            });
        });
        </script>




        <script>
        require(['echarts'/*, 'map/js/china' */], function (echarts) {

            function renderItem(params, api) {
                var pos = api.coord([api.value(0), api.value(1)]);
                var paletteColor = api.visual('color');
                var paletteDecal = api.visual('decal');
                if (params.dataIndex === 0) {
                    return {
                        type: 'group',
                        x: pos[0],
                        y: pos[1],
                        children: [{
                            type: 'circle',
                            shape: { cx: 0, cy: 0, r: 30 },
                            style: {
                                fill: 'orange',
                                decal: {
                                    color: 'blue',
                                    dashArrayX: [1, 0],
                                    dashArrayY: [4, 3],
                                    dashLineOffset: 0,
                                    rotation: -Math.PI / 4
                                }
                            }
                        }, {
                            type: 'circle',
                            shape: { cx: 60, cy: 0, r: 30 },
                            style: { fill: 'orange' }
                        }]
                    }
                }
                else {
                    return {
                        type: 'group',
                        x: pos[0],
                        y: pos[1],
                        children: [{
                            type: 'rect',
                            shape: { x: -20, y: -20, width: 40, height: 40 },
                            style: { fill: paletteColor, decal: paletteDecal },
                        }, {
                            type: 'rect',
                            shape: { x: 60 - 20, y: -20, width: 40, height: 40 },
                            style: { fill: paletteColor, decal: paletteDecal },
                        }]
                    }
                }
            }

            var option = {
                xAxis: {
                },
                yAxis: {
                },
                series: [{
                    type: 'custom',
                    renderItem: renderItem,
                    data: [ [11, 22], [55, 22] ]
                }, {
                    type: 'custom',
                    renderItem: renderItem,
                    data: [ [11, 55], [55, 55] ]
                }, {
                    type: 'custom',
                    renderItem: renderItem,
                    data: [ [11, 88], [55, 88] ]
                }],
                aria: {
                    decal: {
                        show: true
                    }
                }
            };

            var chart = testHelper.create(echarts, 'main-custom-series', {
                title: [
                    'All circle/rect should show decals.',
                    'Circel should be in specified decal (in **blue**) and specified color (in **orange**).',
                    'Rect should be in palette decal and palette color'
                ],
                option: option
                // height: 300,
                // buttons: [{text: 'btn-txt', onclick: function () {}}],
                // recordCanvas: true,
            });
        });
        </script>



    </body>
</html>

